<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Day 3 â€” Data Cleaning + SQL Setup</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=IBM+Plex+Mono:wght@300;400;500&family=Fraunces:ital,wght@0,300;1,300&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0d0d0d;
    --surface: #141414;
    --border: #222;
    --accent: #00ff88;
    --accent2: #ffcc00;
    --accent3: #ff6060;
    --blue: #60aaff;
    --purple: #c084fc;
    --text: #eee;
    --muted: #666;
  }
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
  body { background: var(--bg); color: var(--text); font-family: 'IBM Plex Mono', monospace; min-height: 100vh; padding-bottom: 80px; }
  .container { max-width: 860px; margin: 0 auto; padding: 0 24px; }

  header { padding: 56px 0 40px; border-bottom: 1px solid var(--border); }
  .badge { display: inline-block; font-size: 10px; letter-spacing: 3px; text-transform: uppercase; color: var(--accent3); border: 1px solid var(--accent3); padding: 4px 12px; margin-bottom: 20px; }
  h1 { font-family: 'Syne', sans-serif; font-size: clamp(28px, 5vw, 48px); font-weight: 800; line-height: 1.1; }
  h1 span { color: var(--accent3); }
  .sub { margin-top: 14px; color: var(--muted); font-size: 12px; line-height: 1.9; max-width: 600px; }

  .progress { display: flex; gap: 4px; margin-top: 32px; }
  .p-step { flex: 1; height: 3px; background: var(--border); border-radius: 2px; }
  .p-step.done { background: var(--accent); }
  .p-step.active { background: var(--accent3); }

  .cells { margin-top: 48px; display: flex; flex-direction: column; gap: 24px; }

  .cell { background: var(--surface); border: 1px solid var(--border); border-left: 3px solid var(--border); overflow: hidden; transition: border-color 0.3s; }
  .cell:hover { border-color: var(--accent3); border-left-color: var(--accent3); }

  .cell-header { display: flex; align-items: center; gap: 16px; padding: 14px 20px; border-bottom: 1px solid var(--border); background: #111; }
  .cell-num { font-size: 10px; letter-spacing: 2px; color: var(--muted); min-width: 60px; }
  .cell-title { font-family: 'Syne', sans-serif; font-size: 13px; font-weight: 700; color: var(--text); flex: 1; }
  .cell-tag { font-size: 9px; letter-spacing: 2px; text-transform: uppercase; padding: 3px 10px; border-radius: 2px; }
  .tag-green { background: rgba(0,255,136,0.1); border: 1px solid var(--accent); color: var(--accent); }
  .tag-yellow { background: rgba(255,204,0,0.1); border: 1px solid var(--accent2); color: var(--accent2); }
  .tag-red { background: rgba(255,96,96,0.1); border: 1px solid var(--accent3); color: var(--accent3); }
  .tag-blue { background: rgba(96,170,255,0.1); border: 1px solid var(--blue); color: var(--blue); }
  .tag-purple { background: rgba(192,132,252,0.1); border: 1px solid var(--purple); color: var(--purple); }

  .cell-body { padding: 20px; }

  .explain { font-size: 11px; color: var(--muted); line-height: 1.9; margin-bottom: 16px; padding: 12px 16px; border-left: 2px solid var(--accent3); background: rgba(255,96,96,0.03); }
  .explain strong { color: var(--accent3); }

  .code-wrap { background: #090909; border: 1px solid #1c1c1c; padding: 18px 20px; overflow-x: auto; }
  pre { margin: 0; }
  code { font-family: 'IBM Plex Mono', monospace; font-size: 12px; line-height: 2; color: var(--text); }
  .c  { color: #444; }
  .kw { color: var(--blue); }
  .st { color: var(--accent); }
  .fn { color: var(--purple); }
  .nm { color: var(--accent3); }
  .va { color: var(--accent2); }

  .output { margin-top: 12px; background: #060606; border: 1px solid #1a1a1a; border-left: 2px solid var(--accent); padding: 14px 18px; }
  .output-label { font-size: 9px; letter-spacing: 2px; color: var(--accent); text-transform: uppercase; margin-bottom: 8px; }
  .output pre { font-size: 11px; color: #888; line-height: 1.8; white-space: pre-wrap; }
  .output .hl { color: var(--accent); }
  .output .warn { color: var(--accent3); }

  .insight { margin-top: 12px; background: rgba(192,132,252,0.04); border: 1px solid rgba(192,132,252,0.2); border-left: 3px solid var(--purple); padding: 14px 18px; font-size: 11px; color: #aaa; line-height: 1.9; }
  .insight strong { color: var(--purple); }

  .note { background: rgba(255,204,0,0.04); border: 1px solid rgba(255,204,0,0.2); border-left: 3px solid var(--accent2); padding: 14px 18px; font-size: 11px; color: #aaa; line-height: 1.8; margin-top: 12px; }
  .note strong { color: var(--accent2); }

  .divider { margin: 48px 0 32px; font-size: 10px; letter-spacing: 4px; text-transform: uppercase; color: var(--muted); display: flex; align-items: center; gap: 16px; }
  .divider::before, .divider::after { content: ''; flex: 1; height: 1px; background: var(--border); }

  .end-card { margin-top: 48px; background: linear-gradient(135deg, rgba(255,96,96,0.05), rgba(96,170,255,0.03)); border: 1px solid rgba(255,96,96,0.2); padding: 32px; text-align: center; }
  .end-card h2 { font-family: 'Syne', sans-serif; font-size: 20px; font-weight: 800; color: var(--accent3); margin-bottom: 10px; }
  .end-card p { font-size: 12px; color: var(--muted); line-height: 2; }

  .progress-tracker { display: grid; grid-template-columns: repeat(4, 1fr); gap: 2px; margin: 32px 0; }
  .pt-item { background: var(--surface); border: 1px solid var(--border); padding: 16px; text-align: center; }
  .pt-item.done { border-color: var(--accent); }
  .pt-item.active { border-color: var(--accent3); }
  .pt-icon { font-size: 20px; margin-bottom: 6px; }
  .pt-label { font-size: 10px; letter-spacing: 1px; color: var(--muted); }
  .pt-item.done .pt-label { color: var(--accent); }
  .pt-item.active .pt-label { color: var(--accent3); }

  @media(max-width:600px){ code { font-size: 10px; } .progress-tracker { grid-template-columns: repeat(2,1fr); } }
</style>
</head>
<body>
<div class="container">

  <header>
    <div class="badge">Day 3 of 18 Â· Cleaning + SQL</div>
    <h1>Clean Data +<br><span>Build Your Database</span></h1>
    <p class="sub">Raw data is never analysis-ready. Today we clean it properly, build a master table, and load everything into SQLite â€” your personal SQL database that works 100% offline with zero setup.</p>
    <div class="progress">
      <div class="p-step done"></div>
      <div class="p-step done"></div>
      <div class="p-step active"></div>
      <div class="p-step"></div>
      <div class="p-step"></div>
      <div class="p-step"></div>
    </div>
  </header>

  <div class="progress-tracker">
    <div class="pt-item done"><div class="pt-icon">âœ…</div><div class="pt-label">Day 1 Â· Setup</div></div>
    <div class="pt-item done"><div class="pt-icon">âœ…</div><div class="pt-label">Day 2 Â· Explore</div></div>
    <div class="pt-item active"><div class="pt-icon">ğŸ”§</div><div class="pt-label">Day 3 Â· Clean + SQL</div></div>
    <div class="pt-item"><div class="pt-icon">â¬œ</div><div class="pt-label">Day 4 Â· SQL Queries</div></div>
  </div>

  <div class="note"><strong>New file to create:</strong> notebooks/02_data_cleaning.ipynb â€” Create this now in VS Code before running any cells below.</div>

  <div class="cells">

    <!-- CELL 1 -->
    <div class="cell">
      <div class="cell-header">
        <div class="cell-num">CELL 01</div>
        <div class="cell-title">Load Raw Data Again + Imports</div>
        <div class="cell-tag tag-green">Start Here</div>
      </div>
      <div class="cell-body">
        <div class="explain">Every notebook starts fresh. We reload the data and import everything we need. This is standard practice â€” each notebook is independent.</div>
        <div class="code-wrap"><pre><code><span class="kw">import</span> pandas <span class="kw">as</span> pd
<span class="kw">import</span> numpy <span class="kw">as</span> np
<span class="kw">import</span> os
<span class="kw">import</span> sqlite3
<span class="kw">from</span> sqlalchemy <span class="kw">import</span> create_engine

DATA_PATH = <span class="st">'../data/raw/'</span>

<span class="c"># Load all tables</span>
<span class="va">tables</span> = {}
<span class="kw">for</span> file <span class="kw">in</span> os.<span class="fn">listdir</span>(DATA_PATH):
    <span class="kw">if</span> file.<span class="fn">endswith</span>(<span class="st">'.csv'</span>):
        name = file.<span class="fn">replace</span>(<span class="st">'olist_'</span>,<span class="st">''</span>).<span class="fn">replace</span>(<span class="st">'_dataset.csv'</span>,<span class="st">''</span>).<span class="fn">replace</span>(<span class="st">'.csv'</span>,<span class="st">''</span>)
        tables[name] = pd.<span class="fn">read_csv</span>(DATA_PATH + file)

<span class="fn">print</span>(<span class="st">"âœ“ All tables loaded"</span>)
<span class="fn">print</span>(<span class="st">"Tables available:"</span>, <span class="fn">list</span>(tables.<span class="fn">keys</span>()))
</code></pre></div>
      </div>
    </div>

    <!-- CELL 2 -->
    <div class="cell">
      <div class="cell-header">
        <div class="cell-num">CELL 02</div>
        <div class="cell-title">Clean the Orders Table</div>
        <div class="cell-tag tag-red">Core Cleaning</div>
      </div>
      <div class="cell-body">
        <div class="explain"><strong>Rule 1:</strong> Only keep delivered orders for revenue analysis. <strong>Rule 2:</strong> Convert all date columns from strings to proper datetime. <strong>Rule 3:</strong> Calculate delivery time as a new feature.</div>
        <div class="code-wrap"><pre><code><span class="va">orders</span> = tables[<span class="st">'orders'</span>].<span class="fn">copy</span>()

<span class="c"># Step 1: Keep only delivered orders</span>
<span class="va">orders</span> = orders[orders[<span class="st">'order_status'</span>] == <span class="st">'delivered'</span>].<span class="fn">copy</span>()
<span class="fn">print</span>(<span class="st">f"After filter: {len(orders):,} delivered orders"</span>)

<span class="c"># Step 2: Convert date columns to datetime</span>
<span class="va">date_cols</span> = [
    <span class="st">'order_purchase_timestamp'</span>,
    <span class="st">'order_approved_at'</span>,
    <span class="st">'order_delivered_carrier_date'</span>,
    <span class="st">'order_delivered_customer_date'</span>,
    <span class="st">'order_estimated_delivery_date'</span>
]
<span class="kw">for</span> col <span class="kw">in</span> date_cols:
    orders[col] = pd.<span class="fn">to_datetime</span>(orders[col])

<span class="c"># Step 3: Engineer delivery_days feature</span>
orders[<span class="st">'delivery_days'</span>] = (
    orders[<span class="st">'order_delivered_customer_date'</span>] -
    orders[<span class="st">'order_purchase_timestamp'</span>]
).<span class="fn">dt.days</span>

<span class="c"># Step 4: Engineer late_delivery flag</span>
orders[<span class="st">'is_late'</span>] = (
    orders[<span class="st">'order_delivered_customer_date'</span>] >
    orders[<span class="st">'order_estimated_delivery_date'</span>]
).<span class="fn">astype</span>(<span class="nm">int</span>)

<span class="c"># Step 5: Extract time features</span>
orders[<span class="st">'purchase_year'</span>]  = orders[<span class="st">'order_purchase_timestamp'</span>].<span class="fn">dt.year</span>
orders[<span class="st">'purchase_month'</span>] = orders[<span class="st">'order_purchase_timestamp'</span>].<span class="fn">dt.month</span>
orders[<span class="st">'purchase_dow'</span>]   = orders[<span class="st">'order_purchase_timestamp'</span>].<span class="fn">dt.day_name</span>()

<span class="fn">print</span>(<span class="st">f"Late deliveries: {orders['is_late'].sum():,} ({orders['is_late'].mean()*100:.1f}%)"</span>)
<span class="fn">print</span>(<span class="st">f"Avg delivery days: {orders['delivery_days'].mean():.1f}"</span>)
<span class="fn">print</span>(<span class="st">"\nâœ“ Orders cleaned"</span>)
</code></pre></div>
        <div class="output">
          <div class="output-label">Expected Output</div>
          <pre><span class="hl">After filter: 96,478 delivered orders
Late deliveries: 6,535 (6.8%)
Avg delivery days: 12.1
âœ“ Orders cleaned</span></pre>
        </div>
        <div class="insight"><strong>You just created 4 new features</strong> from raw dates â€” delivery_days, is_late, purchase_year, purchase_month. This is feature engineering. You'll use all 4 in the ML model later.</div>
      </div>
    </div>

    <!-- CELL 3 -->
    <div class="cell">
      <div class="cell-header">
        <div class="cell-num">CELL 03</div>
        <div class="cell-title">Clean Payments + Products + Reviews</div>
        <div class="cell-tag tag-red">Core Cleaning</div>
      </div>
      <div class="cell-body">
        <div class="explain">Clean the remaining tables. Each one needs specific treatment. We aggregate payments per order (since one order can have split payments) and translate product categories to English.</div>
        <div class="code-wrap"><pre><code><span class="c">## â”€â”€ PAYMENTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="va">payments</span> = tables[<span class="st">'order_payments'</span>].<span class="fn">copy</span>()

<span class="c"># Aggregate to one row per order (sum split payments)</span>
<span class="va">payments_agg</span> = payments.<span class="fn">groupby</span>(<span class="st">'order_id'</span>).<span class="fn">agg</span>(
    total_payment    = (<span class="st">'payment_value'</span>,    <span class="st">'sum'</span>),
    payment_type     = (<span class="st">'payment_type'</span>,     <span class="st">'first'</span>),
    installments     = (<span class="st">'payment_installments'</span>, <span class="st">'max'</span>)
).<span class="fn">reset_index</span>()

<span class="fn">print</span>(<span class="st">f"Payments aggregated: {len(payments_agg):,} orders"</span>)

<span class="c">## â”€â”€ PRODUCTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="va">products</span> = tables[<span class="st">'products'</span>].<span class="fn">copy</span>()
<span class="va">trans</span>     = tables[<span class="st">'product_category_name_translation'</span>].<span class="fn">copy</span>()

<span class="c"># Translate category names to English</span>
<span class="va">products</span> = products.<span class="fn">merge</span>(trans, on=<span class="st">'product_category_name'</span>, how=<span class="st">'left'</span>)

<span class="c"># Fill missing category with 'unknown'</span>
products[<span class="st">'product_category_name_english'</span>] = (
    products[<span class="st">'product_category_name_english'</span>]
    .<span class="fn">fillna</span>(<span class="st">'unknown'</span>)
)

<span class="fn">print</span>(<span class="st">f"Products cleaned: {len(products):,} products"</span>)

<span class="c">## â”€â”€ REVIEWS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="va">reviews</span> = tables[<span class="st">'order_reviews'</span>].<span class="fn">copy</span>()

<span class="c"># Keep only score and order_id (that's all we need)</span>
<span class="va">reviews_clean</span> = reviews[[<span class="st">'order_id'</span>, <span class="st">'review_score'</span>]].<span class="fn">copy</span>()

<span class="c"># Drop duplicate order reviews (keep last)</span>
<span class="va">reviews_clean</span> = reviews_clean.<span class="fn">drop_duplicates</span>(subset=<span class="st">'order_id'</span>, keep=<span class="st">'last'</span>)

<span class="fn">print</span>(<span class="st">f"Reviews cleaned: {len(reviews_clean):,} reviews"</span>)
<span class="fn">print</span>(<span class="st">"\nâœ“ All tables cleaned"</span>)
</code></pre></div>
        <div class="insight"><strong>Key move:</strong> Aggregating payments to one row per order is critical. If you don't do this, joining with orders creates duplicate rows and inflates your revenue numbers. This is a common mistake beginners make â€” you just avoided it.</div>
      </div>
    </div>

    <!-- CELL 4 -->
    <div class="cell">
      <div class="cell-header">
        <div class="cell-num">CELL 04</div>
        <div class="cell-title">Build the Master Orders Table</div>
        <div class="cell-tag tag-yellow">Key Output</div>
      </div>
      <div class="cell-body">
        <div class="explain">We now join everything into ONE master table. This is your <strong>single source of truth</strong> for all analysis going forward. Every join is intentional â€” understand why each one is there.</div>
        <div class="code-wrap"><pre><code><span class="va">items</span>     = tables[<span class="st">'order_items'</span>].<span class="fn">copy</span>()
<span class="va">customers</span> = tables[<span class="st">'customers'</span>].<span class="fn">copy</span>()

<span class="c"># Aggregate items per order</span>
<span class="va">items_agg</span> = items.<span class="fn">groupby</span>(<span class="st">'order_id'</span>).<span class="fn">agg</span>(
    item_count       = (<span class="st">'order_item_id'</span>,  <span class="st">'count'</span>),
    total_price      = (<span class="st">'price'</span>,          <span class="st">'sum'</span>),
    total_freight    = (<span class="st">'freight_value'</span>,  <span class="st">'sum'</span>),
    product_id       = (<span class="st">'product_id'</span>,     <span class="st">'first'</span>)
).<span class="fn">reset_index</span>()

<span class="c"># Build master table step by step</span>
<span class="va">master</span> = (
    orders                                          <span class="c"># base: 96,478 delivered orders</span>
    .<span class="fn">merge</span>(customers,     on=<span class="st">'customer_id'</span>)        <span class="c"># add customer location</span>
    .<span class="fn">merge</span>(payments_agg,  on=<span class="st">'order_id'</span>)           <span class="c"># add payment info</span>
    .<span class="fn">merge</span>(items_agg,     on=<span class="st">'order_id'</span>)           <span class="c"># add item details</span>
    .<span class="fn">merge</span>(reviews_clean, on=<span class="st">'order_id'</span>, how=<span class="st">'left'</span>) <span class="c"># add review score</span>
    .<span class="fn">merge</span>(products[[<span class="st">'product_id'</span>,<span class="st">'product_category_name_english'</span>]],
           on=<span class="st">'product_id'</span>, how=<span class="st">'left'</span>)            <span class="c"># add category</span>
)

<span class="fn">print</span>(<span class="st">f"Master table shape: {master.shape}"</span>)
<span class="fn">print</span>(<span class="st">f"Columns: {list(master.columns)}"</span>)
<span class="fn">print</span>(<span class="st">f"\nSample row:"</span>)
master.<span class="fn">head</span>(<span class="nm">2</span>)
</code></pre></div>
        <div class="output">
          <div class="output-label">Expected Output</div>
          <pre><span class="hl">Master table shape: (96478, 24)
24 columns covering orders, customers,
payments, items, reviews, and categories
all in one clean table âœ“</span></pre>
        </div>
      </div>
    </div>

    <!-- CELL 5 -->
    <div class="cell">
      <div class="cell-header">
        <div class="cell-num">CELL 05</div>
        <div class="cell-title">Save Cleaned Data to CSV</div>
        <div class="cell-tag tag-green">Save</div>
      </div>
      <div class="cell-body">
        <div class="explain">Save the master table to <strong>data/processed/</strong> folder. This is your clean layer â€” every future notebook reads from here, never from raw again.</div>
        <div class="code-wrap"><pre><code><span class="c"># Save master table</span>
master.<span class="fn">to_csv</span>(<span class="st">'../data/processed/master_orders.csv'</span>, index=<span class="nm">False</span>)

<span class="c"># Save individual cleaned tables too</span>
orders.<span class="fn">to_csv</span>(<span class="st">'../data/processed/orders_clean.csv'</span>,   index=<span class="nm">False</span>)
products.<span class="fn">to_csv</span>(<span class="st">'../data/processed/products_clean.csv'</span>, index=<span class="nm">False</span>)
customers.<span class="fn">to_csv</span>(<span class="st">'../data/processed/customers_clean.csv'</span>,index=<span class="nm">False</span>)

<span class="fn">print</span>(<span class="st">"âœ“ Saved: data/processed/master_orders.csv"</span>)
<span class="fn">print</span>(<span class="st">"âœ“ Saved: data/processed/orders_clean.csv"</span>)
<span class="fn">print</span>(<span class="st">"âœ“ Saved: data/processed/products_clean.csv"</span>)
<span class="fn">print</span>(<span class="st">"âœ“ Saved: data/processed/customers_clean.csv"</span>)
<span class="fn">print</span>(<span class="st">f"\nMaster table: {len(master):,} rows Ã— {len(master.columns)} columns"</span>)
</code></pre></div>
      </div>
    </div>

    <!-- CELL 6 -->
    <div class="cell">
      <div class="cell-header">
        <div class="cell-num">CELL 06</div>
        <div class="cell-title">Load Everything into SQLite Database</div>
        <div class="cell-tag tag-purple">SQL Setup</div>
      </div>
      <div class="cell-body">
        <div class="explain"><strong>Why SQLite?</strong> It's a real SQL database that lives as a single file on your computer. Zero setup, works offline, and you can run proper SQL queries on it. Perfect for your portfolio â€” no one needs to install anything to see your SQL work.</div>
        <div class="code-wrap"><pre><code><span class="c"># Create SQLite database in your project folder</span>
<span class="va">engine</span> = <span class="fn">create_engine</span>(<span class="st">'sqlite:///../data/olist.db'</span>)

<span class="c"># Load all clean tables into the database</span>
<span class="va">tables_to_load</span> = {
    <span class="st">'master_orders'</span>  : master,
    <span class="st">'orders'</span>         : orders,
    <span class="st">'customers'</span>      : customers,
    <span class="st">'products'</span>       : products,
    <span class="st">'payments'</span>       : payments_agg,
    <span class="st">'reviews'</span>        : reviews_clean,
    <span class="st">'order_items'</span>    : items,
    <span class="st">'sellers'</span>        : tables[<span class="st">'sellers'</span>],
}

<span class="kw">for</span> table_name, df <span class="kw">in</span> tables_to_load.<span class="fn">items</span>():
    df.<span class="fn">to_sql</span>(table_name, engine, if_exists=<span class="st">'replace'</span>, index=<span class="nm">False</span>)
    <span class="fn">print</span>(<span class="st">f"  âœ“ Loaded {table_name:<20} {len(df):>8,} rows"</span>)

<span class="fn">print</span>(<span class="st">"\nâœ… SQLite database ready at: data/olist.db"</span>)
</code></pre></div>
        <div class="output">
          <div class="output-label">Expected Output</div>
          <pre><span class="hl">  âœ“ Loaded master_orders          96,478 rows
  âœ“ Loaded orders                  96,478 rows
  âœ“ Loaded customers               99,441 rows
  âœ“ Loaded products                32,951 rows
  âœ“ Loaded payments                99,441 rows
  âœ“ Loaded reviews                 98,371 rows
  âœ“ Loaded order_items            112,650 rows
  âœ“ Loaded sellers                  3,095 rows

âœ… SQLite database ready at: data/olist.db</span></pre>
        </div>
      </div>
    </div>

    <!-- CELL 7 -->
    <div class="cell">
      <div class="cell-header">
        <div class="cell-num">CELL 07</div>
        <div class="cell-title">Test Your SQL Database â€” Run Your First Query</div>
        <div class="cell-tag tag-blue">Verify SQL Works</div>
      </div>
      <div class="cell-body">
        <div class="explain">Let's confirm SQL is working by running a real query directly from Python. This is how analysts query databases in real jobs â€” Python calls SQL, gets results as a DataFrame.</div>
        <div class="code-wrap"><pre><code><span class="kw">import</span> sqlite3

<span class="c"># Connect to the database</span>
<span class="va">conn</span> = sqlite3.<span class="fn">connect</span>(<span class="st">'../data/olist.db'</span>)

<span class="c"># Your first real SQL query â€” monthly revenue</span>
<span class="va">query</span> = <span class="st">"""
SELECT
    strftime('%Y-%m', order_purchase_timestamp) AS month,
    COUNT(DISTINCT order_id)                    AS total_orders,
    ROUND(SUM(total_payment), 2)                AS revenue,
    ROUND(AVG(total_payment), 2)                AS avg_order_value
FROM master_orders
GROUP BY month
ORDER BY month
LIMIT 10;
"""</span>

<span class="va">result</span> = pd.<span class="fn">read_sql_query</span>(query, conn)
<span class="fn">print</span>(result.<span class="fn">to_string</span>(index=<span class="nm">False</span>))
conn.<span class="fn">close</span>()
</code></pre></div>
        <div class="output">
          <div class="output-label">Expected Output â€” Real SQL Results</div>
          <pre><span class="hl">  month  total_orders    revenue  avg_order_value
2016-09             4    1108.44           277.11
2016-10           320   53948.77           168.59
2016-12             1     110.90           110.90
2017-01           800  133972.25           167.47
2017-02          1780  287695.48           161.62
...</span></pre>
        </div>
        <div class="insight"><strong>You just ran SQL on your own database.</strong> This is exactly how data analysts work at companies â€” they write SQL queries that return DataFrames they can then visualize or feed into models. Tomorrow we write 5 advanced SQL queries for your portfolio.</div>
      </div>
    </div>

  </div>

  <div class="divider">Day 3 Complete</div>

  <div class="end-card">
    <h2>Your Database is Live ğŸ—„ï¸</h2>
    <p>
      You now have a <strong style="color:var(--accent)">clean master table (96,478 rows Ã— 24 columns)</strong> and a working SQLite database with 8 tables.<br><br>
      <strong style="color:var(--accent3)">Day 4:</strong> We write 5 advanced SQL queries â€” cohort analysis, RFM scoring, Pareto revenue, late delivery impact.<br><br>
      <strong style="color:var(--accent2)">Run all 7 cells and tell me your master table shape!</strong><br>
      It should be <strong style="color:var(--accent)">(96478, 24)</strong> â€” if it's different, share it and I'll fix it.
    </p>
  </div>

</div>
</body>
</html>
